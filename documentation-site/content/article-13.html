<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>Using our Prefect Video API - Eagle Eye Networks API</title>
    <style>
        
        .preview_img {
            width: 320px;
            height: 180px;
        }

        img {
            width: 100%;
            border: grey solid thin;
        }

        body {
          padding-top: 5rem;
        }

        .starter-template {
          padding: 3rem 1.5rem;
          text-align: center;
        }

        .row {
            padding-top: 10px;
            padding-bottom: 20px;
        }

        h2 {
            border-bottom: thick linen solid;
        }


    </style>
</head>
<body>
    <main role="main" class="container-fluid">
        <div class="container-fluid">
            <div class="row" id="camera_holder"></div>

            <div class="row">
                <div class="col-9 offset-1">
                    <h1>Prefetch Video with Webhooks</h1>
                </div>
            </div>


            <div class="row">
                <div class="col-9 offset-1"> 
                    <p>
                       The traditional HTTP request/response model is that you the server waits for you to make a request, it does something while you wait for it to return something.  This is straight-forward and works well in most situations.  This article is going to be about a situation where this may not be optimal.
                    </p>
                    <p>
                        If you are requesting a lot of videos, or video that hasn't been uploaded to the cloud yet, you may want to skip the waiting involved in the traditional request/response model.  You can do this by requesting the video and then asking the server to notify you when it has a response for you.  This allows you to queue up a list of videos.  You no longer need to keep each connection open waiting on a response.
                    </p>
                    <p>
                        Think about this as ordreing from a fast food resturant vs hot dog cart.   At a fast food place, you put in your order at a cash register and they give you a number.  When your food is ready they call that number and you can pick up your food.  At a hot dog cart, there is only one guy running it so you order with him, wait for him to make the food, he gives you the food and then you pay.  During the lunch rush the fast food resturant is much more efficient and can handle a much higher number of customers.
                    </p>
                    <p>
                        Using what we learned from the fast food place, we want get the same effiency gains.  We do this through Webhooks.  Webhooks are the pattern of leaving a URL for a server to POST to when it is ready.  In our case we require a Webhook to call when the request has succeeded and optional a webhook to call if the request fails.  In both cases we will give you a block of JSON data.  You will need to be able to handle receiving a POST request to the specified Webhook URLs.
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col-11 offset-1">
                    <h2>Step 1: Login</h2>
                </div>
            </div>

            <div class="row">
                <div class="col-8 offset-1">       
                   <p>
                       The first step in working with our API is to login with your username, password and API key.  All requests to our API should include the <a href="https://apidocs.eagleeyenetworks.com/apidocs/#get-an-api-key">API key that you created</a>.  After the <a href="https://apidocs.eagleeyenetworks.com/apidocs/#authentication">Authentication</a> step, you will get a token which you will then need to pass into the <a href="https://apidocs.eagleeyenetworks.com/apidocs/#3-authorize">Authorization</a> step.  We automatically return you the user information for the user who just logged-in.
                    </p>
                    <p>
                        After successfully completing the login process you will get a session cookie to use on all calls during the remainder of your session.  Note: you can change the cookie experation length as a user account setting.
                   </p>
                </div>
                <div class="col-3"></div>
            </div>

            <div class="row">
                <div class="col-11 offset-1">
                    <h2>Step 2: Get Devices</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-8 offset-1">
                     <p>
                        The currently logged-in user is able to get information about what <a href="https://apidocs.eagleeyenetworks.com/apidocs/#get-list-of-cameras">devices they have been given access to</a>.  In the linked example webapp, we display them all and let you choose from the list.
                    </p>
                </div>
                <div class="col-3"></div>
            </div>


            <div class="row">
                <div class="col-11 offset-1">
                    <h2>Step 3: Get List of Videos</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-8 offset-1">
                    <p>
                        The <a href="https://apidocs.eagleeyenetworks.com/apidocs/#get-list-of-videos">Get List of Videos</a> API call will return information about all of the videos for the specified camera between the timestamps provided.  This is from the metadata that the bridge has sent to the cloud.  This doesn't neccessarily mean it is in the cloud yet.
                    </p>
                </div>
                <div class="col-3">
                </div>
            </div>


            <div class="row">
                <div class="col-11 offset-1">
                    <h2>Step 4: Make the requests</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-8 offset-1">
                    <p>
                        Using the pre-fetch API is similar to <a href="https://apidocs.eagleeyenetworks.com/apidocs/#get-video">retrieving a video</a>.  The difference is that you need to supply a URL for the `success_hook` to call when the video has been successfully uploaded.  There is also a `failure_hook` that is optional and it will be called if the video upload was not successful.  An example failure case could be if the bridge has been unplugged and is not able to upload data.  Another failure situation would be if the video requested is out of the retention period.
                    </p>
                    <p>
                        Unlike most of our examples, to run this example you will need a publically accessable URL to receive the success_hook. This makes it a little bit harder to experiment with this example.
                    </p>
                    <p>
                        You will make the request as outlined in the <a href="https://apidocs.eagleeyenetworks.com/apidocs/#prefetch-video">prefetch video</a> documentation.
                    </p>
                    <p>
                        Please be aware that this call may trigger an on-demand upload from the bridge.  If the video is not yet in the cloud it will be prioritized immediately and uploaded.  This is exactly what we are asking it to do.  Please keep in mind that doing a large ammount of videos simultaniously may use all the avialable bandwidth.  Care should be used not to negatively impact the site where the bridge is connected.
                    <p>
                        I have released a full working demo of a webserver that does all of these steps.  It can be found on <a href="https://github.com/EENCloud/API-Documentation/tree/master/EE-downloader">Github</a>.  I will continue to improve it and it will be features in several future blog posts.
                    </p>
                </div>
                <div class="col-3">
                </div>
            </div>

            <div class="row">
                <div class="col-11 offset-1">
                    <h2>Step 5: Handle the webhook callback</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-8 offset-1">
                    <p>
                        The data send back with the webhook will return the original arguments used to create the hook.  This way you can reconstruct the original arguments without needing to maintain a list of outstanding requests.  This provides the ability to handle the video in parallel instead of serially.
                    </p>
                </div>
                <div class="col-3">
                </div>
            </div>

            <div class="row">
                <div class="col-11 offset-1">
                    <h2>What else can we do with this?</h2>
                </div>
            </div>
            <div class="row">
                <div class="col-9 offset-1">
                    <p>
                        This could be used to move older videos to cold storage.  It could also be used to improve the user experience when a user requests a video.  It is possible to use this webhook model to scale up post-processing or video analytics without the need for central coordination.
                    </p>
                    <p>
                        I hope you found this helpful.  If you have any questions please feel free to reach out to us at api_support@een.com
                    </p>
                
                </div>

            </div>
            
        </div>

    </main>

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>

</body>
</html>
