<!DOCTYPE html>
<html>
<body>
	<img id="img" src=""/>
</body>

<script>


// Start with declairing the basic variables
account_sub_domain = "c000";
account_id = "00001106";
camera_id = "10058b7a";
auth_key = "c000~5b2286783805c5ad7bda186de113d901"


// Build the subscription string
data = {"cameras": {}};
data.cameras[camera_id] = {"resource": ["event"], "event": ["ANNT"]}


// Build the WebSocket connection URL
connection_url = [
			"wss://", 
			account_sub_domain,
			".eagleeyenetworks.com",
			"/api/v2/Device/",
			account_id,
			"/Events?A=",
			auth_key
		].join('');


// make the WebSocket connection
socket = new WebSocket(connection_url);


// when the socket opens, register the subscriptions
socket.addEventListener('open', function(event) {
	console.log('socket opened');
	socket.send(JSON.stringify(data));
});

// for every message received, parse the data into an object and update the image on the page
// send an acknowledgement that you are ready for the next image
socket.addEventListener('message', function(event) {
	//console.log(event.data);
	json = JSON.parse(event.data);

	//shorten it down to somethign manageable
	json = json['data'][camera_id]['event']['ANNT'];

	if(json) {
		if(json['ns'] == 1001) { 
			console.log(json);
		} else {
			console.log("got " + json['ns'] + " event, ignoring it for now");
		}
	} else {
		console.log('got something, but it wasn\'t what we expected');
	}
});

// handle the close event
socket.addEventListener('close', function(event) {
	console.log('socket closed')
});

// handle any errors
socket.addEventListener('error', function(event) {
	console.log('socket error ', event);
});

</script>
</html>
